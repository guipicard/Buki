#include "DemoScene.h"
#include "Engine.h"
#include "Engine.h"
#include "Entity.h"
#include "Atlas.h"
#include "Controller.h"

DemoScene::DemoScene()
{
	m_Entity1 = nullptr;
	m_Player = nullptr;
	mumu = buki::Engine::GetInstance()->Audio().LoadMusic("./audio/mixkit-driving-ambition-32.mp3");
	sam = buki::Engine::GetInstance()->Audio().LoadSound("./audio/mixkit-arcade-retro-game-over-213.wav");
}

void DemoScene::Load()
{
	buki::Engine::GetInstance()->Audio().PlayMusic(mumu);
	m_Entity1 = Instantiate("map");
	m_Entity1->AddComponent<Atlas>();
	Atlas* _atlas = m_Entity1->GetComponent<Atlas>();
	_atlas->SetPath("./assets/env.png");
	_atlas->LoadTileset("./assets/env.png", 32, 32, 36, 540);
	_atlas->SetLayerLength(25);
	TLayer waterLayer = _atlas->CreateLayerFromCVS({
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
			34,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34
		});
	TLayer groundLayer = _atlas->CreateLayerFromCVS({
			5,6,7,7,7,7,7,7,7,7,7,7,8,7,7,7,7,7,7,7,7,7,7,7,8,
			41,42,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,44,
			77,78,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,80,
			77,78,79,79,79,79,2,79,79,79,79,2,79,79,79,79,79,79,79,79,79,79,79,79,80,
			77,78,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,80,
			77,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,79,79,79,79,2,80,
			77,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,79,79,79,79,2,80,
			77,0,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,2,79,79,79,79,2,80,
			77,0,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,79,79,79,79,79,2,80,
			77,0,79,79,79,79,79,79,79,79,79,79,79,79,79,0,0,0,79,79,79,79,79,2,80,
			77,0,79,79,79,79,79,79,79,79,79,79,79,79,79,0,0,0,79,79,79,79,79,2,80,
			77,0,79,79,79,79,79,79,79,79,79,79,79,79,79,0,0,0,0,0,476,0,0,0,80,
			77,0,79,79,79,79,79,79,79,79,79,79,79,79,79,2,0,0,0,0,476,0,0,0,80,
			113,0,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,2,80,
			77,0,79,79,2,2,2,2,2,2,79,79,79,79,79,79,79,79,79,79,79,79,79,79,80,
			77,0,79,79,2,2,2,2,2,79,79,79,79,79,79,79,79,79,79,2,2,2,79,79,80,
			77,0,79,2,2,2,2,2,2,2,79,79,79,79,79,79,79,79,79,2,2,2,79,79,80,
			77,0,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,79,80,
			113,114,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,115,116
		});
	TLayer treesLayer = _atlas->CreateLayerFromCVS({
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,74,0,0,0,0,74,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,74,0,0,0,0,74,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,74,0,0,0,0,74,0,
			0,0,0,74,74,74,74,74,74,74,74,74,74,74,74,0,0,0,74,0,0,0,0,74,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,74,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,74,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,74,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,74,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,74,0,
			0,0,0,0,0,74,74,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,74,74,38,38,38,0,0,0,0,0,0,0,0,0,0,74,74,74,0,0,0,
			0,0,0,74,74,38,38,0,38,38,0,0,0,0,0,0,0,0,0,74,74,74,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
		});
	_atlas->AddLayer("a", waterLayer);
	_atlas->AddLayer("b", groundLayer);
	_atlas->AddLayer("c", treesLayer);

	Entity* m_Player = Instantiate("player");
	m_Player->SetPos(Point2D(60, 60));
	m_Player->SetSize(Point2D(32, 32));
	m_Player->AddComponent<Sprite>();
	Sprite* _sprite = m_Player->GetComponent<Sprite>();
	_sprite->SetPath("./assets/lolo.png");
	_sprite->SetSrc(RectI(0, 0, 32, 32));
	m_Player->AddComponent<Controller>();
}
